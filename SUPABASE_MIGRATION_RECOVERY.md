# ğŸš€ Supabase Migrationå®Œå…¨å¾©æ—§æ‰‹é †

## ğŸ“Š ç™ºè¦‹ã•ã‚ŒãŸ Migration ãƒ•ã‚¡ã‚¤ãƒ«

âœ… **å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç™ºè¦‹ï¼**  
`/Users/syokota_mac/Desktop/claude-code/learning-projects/camping-car-apps/supabase/migrations/`

### ğŸ“ åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«
```
20240730_create_tables.sql           - åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
20250131_purpose_checklist_tables.sql - ç›®çš„ãƒ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé–¢é€£
20250131_insert_purposes_data.sql     - ãƒ¡ã‚¤ãƒ³ãƒ»ã‚µãƒ–ç›®çš„ãƒ‡ãƒ¼ã‚¿
20250131_insert_default_items.sql     - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒã¡ç‰©ãƒ‡ãƒ¼ã‚¿  
20250131_enable_rls.sql              - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
20250135_all_data_and_rls.sql        - çµ±åˆãƒ‡ãƒ¼ã‚¿+RLS
20250201_create_rules_manners.sql     - æ—…è¡ŒãƒãƒŠãƒ¼æ©Ÿèƒ½
20250201_insert_rules_data.sql       - ãƒãƒŠãƒ¼ãƒ‡ãƒ¼ã‚¿
20250201_create_trip_reviews.sql     - ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
20250803_add_family_pet_other_purposes.sql - è¿½åŠ ç›®çš„
```

## âš¡ åˆ¶é™è§£é™¤å¾Œã®å³åº§å¾©æ—§

### **Method 1: Supabase CLIä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰**

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /Users/syokota_mac/Desktop/claude-code/learning-projects/camping-car-apps

# Supabase CLIã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ã®å ´åˆï¼‰
supabase login

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªãƒ³ã‚¯
supabase link --project-ref rwxllvnuuxabvgxpeuma

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆå…¨ä½“ï¼‰
supabase db push

# ã¾ãŸã¯å€‹åˆ¥å®Ÿè¡Œ
supabase db reset --db-url "postgresql://postgres:[password]@db.rwxllvnuuxabvgxpeuma.supabase.co:5432/postgres"
```

### **Method 2: SQL Editorã§å€‹åˆ¥å®Ÿè¡Œ**

åˆ¶é™è§£é™¤ç¢ºèªå¾Œã€ä»¥ä¸‹ã®é †åºã§å®Ÿè¡Œï¼š

#### **Step 1: ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ä½œæˆ**
```sql
-- 20250131_purpose_checklist_tables.sql ã®å†…å®¹å®Ÿè¡Œ
-- CREATE TABLEã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã™ã¹ã¦
```

#### **Step 2: ãƒ‡ãƒ¼ã‚¿æŠ•å…¥**
```sql  
-- 20250131_insert_purposes_data.sql å®Ÿè¡Œ
-- ãƒ¡ã‚¤ãƒ³ç›®çš„ï¼ˆ16ä»¶ï¼‰+ ã‚µãƒ–ç›®çš„ï¼ˆ11ä»¶ï¼‰

-- 20250131_insert_default_items.sql å®Ÿè¡Œ  
-- å„ç›®çš„ã«å¯¾å¿œã™ã‚‹æŒã¡ç‰©ãƒ‡ãƒ¼ã‚¿
```

#### **Step 3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**
```sql
-- 20250131_enable_rls.sql å®Ÿè¡Œ
-- Row Level Securityæœ‰åŠ¹åŒ–
```

## ğŸ“‹ å¾©æ—§å¾Œç¢ºèªé …ç›®

### **ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ç¢ºèª**
```sql
SELECT 'main_purposes' as table_name, COUNT(*) as count FROM main_purposes
UNION ALL
SELECT 'sub_purposes', COUNT(*) FROM sub_purposes  
UNION ALL
SELECT 'default_items', COUNT(*) FROM default_items;
```

**æœŸå¾…ã™ã‚‹çµæœ:**
- main_purposes: 16ä»¶
- sub_purposes: 11ä»¶  
- default_items: 85ä»¶ï¼ˆå„ç›®çš„Ã—5ä»¶ï¼‰

### **ã‚¢ãƒ—ãƒªå‹•ä½œç¢ºèª**
```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
cd travel-journal
lsof -ti:3000 | xargs kill -9 && npm start
```

**ç¢ºèªé …ç›®:**
- [x] ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- [ ] ãƒ¡ã‚¤ãƒ³ç›®çš„è¡¨ç¤ºï¼ˆ16ä»¶ï¼‰
- [ ] ã‚µãƒ–ç›®çš„è¡¨ç¤ºï¼ˆ11ä»¶ï¼‰
- [ ] æŒã¡ç‰©ææ¡ˆè¡¨ç¤º  
- [ ] æ–°è¦æ—…è¡Œä½œæˆ
- [ ] ãƒ‡ãƒ¼ã‚¿ä¿å­˜

## ğŸ’¡ Migrationå†…å®¹ã®è©³ç´°

### **ãƒ¡ã‚¤ãƒ³ç›®çš„ (16ä»¶)**
```
è¦³å…‰, SUPãƒ»ã‚«ãƒ¤ãƒƒã‚¯, ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°, ã‚¹ã‚­ãƒ¼ãƒ»ã‚¹ãƒãƒ¼ãƒœãƒ¼ãƒ‰,
ç™»å±±ãƒ»ãƒã‚¤ã‚­ãƒ³ã‚°, ãƒ•ãƒ«ãƒ¼ãƒ„ç‹©ã‚Š, å¤œæ™¯æ’®å½±, å¤©ä½“è¦³æ¸¬,
æ—¥ã®å‡ºãƒ»å¤•é™½æ’®å½±, æµ·æ°´æµ´ãƒ»ã‚·ãƒ¥ãƒãƒ¼ã‚±ãƒªãƒ³ã‚°, æ½®å¹²ç‹©ã‚Š,
èŠ±è¦‹, ç´…è‘‰ç‹©ã‚Š, é‡é³¥è¦³å¯Ÿ, é‡£ã‚Š, é‰„é“æ’®å½±
```

### **ã‚µãƒ–ç›®çš„ (11ä»¶)**  
```
æ¸©æ³‰, é“ã®é§…, ãƒãƒ¼ãƒ™ã‚­ãƒ¥ãƒ¼, ã‚­ãƒ£ãƒ³ãƒ—å ´, RVãƒ‘ãƒ¼ã‚¯,
åœ°å…ƒã‚°ãƒ«ãƒ¡, åœ°å…ƒç‰¹ç”£å“åº—, å±•æœ›å°, æ–‡åŒ–è²¡ãƒ»å²è·¡è¨ªå•,
å›½ç«‹å…¬åœ’, æ™¯å‹åœ°
```

### **æŒã¡ç‰©ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**
å„ãƒ¡ã‚¤ãƒ³ç›®çš„ã«å¯¾ã—ã¦5ä»¶ãšã¤ã®å°‚é–€çš„ãªæŒã¡ç‰©ãƒªã‚¹ãƒˆ

## ğŸš¨ æ³¨æ„äº‹é …

### **1. å®Ÿè¡Œå‰ã®åˆ¶é™è§£é™¤ç¢ºèª**
```bash
# ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªæ¥ç¶šç¢ºèª
node connection-test.js
# "relation does not exist" ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªããªã£ãŸã‚‰å®Ÿè¡Œå¯èƒ½
```

### **2. ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡é˜²æ­¢**  
- Migrationãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ `INSERT` ã®ã¿
- ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã¯äº‹å‰ã«ã‚¯ãƒªã‚¢ã•ã‚Œã¦ã„ã‚‹æƒ³å®š
- é‡è¤‡ãŒå¿ƒé…ãªå ´åˆã¯ `DELETE` ã‚’å…ˆã«å®Ÿè¡Œ

### **3. RLS (Row Level Security)**
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚‚ Migration ã«å«ã¾ã‚Œã‚‹
- èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãŒè‡ªå‹•é©ç”¨

## â° å¾©æ—§äºˆæƒ³æ™‚é–“

- **Migrationå®Ÿè¡Œ**: 1-2åˆ†
- **ã‚¢ãƒ—ãƒªå†èµ·å‹•**: 1åˆ†  
- **å‹•ä½œç¢ºèª**: 3-5åˆ†
- **åˆè¨ˆ**: ç´„10åˆ†ã§å®Œå…¨å¾©æ—§

---

**ğŸ“… ä½œæˆ**: 2025å¹´8æœˆ9æ—¥  
**ğŸ¯ å„ªä½æ€§**: å…ƒã€…ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®Œå…¨å¾©å…ƒ  
**ğŸ”’ å®‰å…¨æ€§**: æ—¢å­˜ã®RLSãƒãƒªã‚·ãƒ¼ç¶­æŒ